<div class="main_page">
  <app-alerts></app-alerts>
  <app-side-menu></app-side-menu>
  <div class="page_main_blocks middle_page">
    <div class="page_header">
      <app-header></app-header>
    </div>
    <div class="page_body_title" [ngClass]="{ pageNotLoaded: !pageLoaded }">
      <h3><i class="fas fa-comment-alt-plus"></i>مسودة الطلبات</h3>
      <div class="button-add-taxs">
        <button
          routerLink="/sales/all-sales"
          *ngIf="user.privilege == 'super-admin'"
        >
          <i class="fas fa-sort-shapes-down-alt"></i> طلبات المبيعات
        </button>
      </div>

      <!-- <a
          routerLink="/sales/add-sale"
          *ngIf="order_add || user.privilege == 'super-admin'"
        >
          إضافة طلب مبيعات جديد
          <i class="fas fa-plus"></i>
        </a> -->
    </div>
    <div class="page_body">
      <div class="page_body_main">
        <div class="page_block">
          <h4>
            <i class="fas fa-comment-alt-plus"></i>
            قائمة مسودة الطلبات
          </h4>
          <div class="countPerPage">
            <select
              name=""
              id=""
              (change)="setCountPerPage($event.target.value)"
              class="selectPerpage"
            >
              <option *ngFor="let option of countPerPage" [value]="option">
                {{ option }}
              </option>
            </select>
          </div>
          <table
            *ngIf="sales.length"
            width="100%"
            dir="rtl"
            mat-table
            [dataSource]="sales"
            class="mat-elevation-z8"
            style="margin-top: 40px;"
            id="display_table"
          >
            <ng-container matColumnDef="ID">
              <th mat-header-cell *matHeaderCellDef>#</th>
              <td mat-cell *matCellDef="let element">
                <span class="styleBold">{{ element.id }} </span>
              </td>
            </ng-container>
            <ng-container matColumnDef="technical_name">
              <th mat-header-cell *matHeaderCellDef>بواسطة</th>
              <td mat-cell *matCellDef="let element">
                {{ element.created_at }}
              </td>
            </ng-container>
            <ng-container matColumnDef="client_name">
              <th mat-header-cell *matHeaderCellDef>تاريخ الاضافة</th>
              <td mat-cell *matCellDef="let element">
                {{ element.created_at ? element.created_at : "" }}
              </td>
            </ng-container>

            <ng-container matColumnDef="main_service">
              <th mat-header-cell *matHeaderCellDef>اسم العميل</th>
              <td mat-cell *matCellDef="let element">
                {{ element.client_name ? element.client_name : "" }}
              </td>
            </ng-container>
            <ng-container matColumnDef="service_date">
              <th mat-header-cell *matHeaderCellDef>رقم الموبايل</th>
              <td mat-cell *matCellDef="let element">
                {{ element.mobile ? element.mobile : "" }}
              </td>
            </ng-container>
            <ng-container matColumnDef="map">
              <th mat-header-cell *matHeaderCellDef>الخريطة</th>
              <td mat-cell *matCellDef="let element">
                <i
                  class="fas fa-map-marked-alt"
                  style="cursor: pointer; font-size: 22px; "
                  (click)="openMap(element)"
                ></i>
              </td>
            </ng-container>
            <ng-container matColumnDef="order_res">
              <th mat-header-cell *matHeaderCellDef>محتويات</th>
              <td mat-cell *matCellDef="let element">
                <span
                  *ngIf="element.add_type == 'sound'"
                  style="font-size: 22px;"
                >
                  <i class="fas fa-waveform-path"></i>
                </span>
                <span
                  *ngIf="element.add_type != 'sound'"
                  style="font-size: 22px;"
                >
                  <i class="fas fa-bullseye-pointer"></i>
                </span>
              </td>
            </ng-container>
            <!-- <ng-container matColumnDef="city">
              <th mat-header-cell *matHeaderCellDef>المدينة</th>
              <td mat-cell *matCellDef="let element">
                {{ element.mobile ? element.mobile : "" }}
              </td>
            </ng-container>
            <ng-container matColumnDef="order_time">
              <th mat-header-cell *matHeaderCellDef>الخدمة</th>
              <td mat-cell *matCellDef="let element">
                {{ element.mobile ? element.mobile : "" }}
              </td>
            </ng-container> -->
            <!-- <ng-container matColumnDef="order_status">
              <th mat-header-cell *matHeaderCellDef>المطلوب</th>
              <td mat-cell *matCellDef="let element">
                {{ element.mobile ? element.mobile : "" }}
              </td>
            </ng-container> -->
            <ng-container matColumnDef="order_details">
              <th mat-header-cell *matHeaderCellDef>التفاصيل</th>
              <td
                mat-cell
                *matCellDef="let element"
                style="display: flex; align-items: center; justify-content: center;"
              >
                <!-- <i class="fas fa-play-circle" style="font-size: 18px;"></i> -->
                <audio controls *ngIf="element.record">
                  <source [src]="element.record" type="audio/wav" />
                  Your browser does not support the audio element.
                </audio>
                <i
                  class="fas fa-trash-alt"
                  (click)="openDeletePopup(element.id, element.client_name)"
                  style="font-size: 18px; margin-right: 10px; cursor: pointer;"
                ></i>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>

          <div class="pagination" *ngIf="sales.length">
            <ul>
              <li>
                <button
                  class="arrow"
                  [disabled]="current_page == totalPage"
                  (click)="nextPage(current_page)"
                >
                  <i class="fas fa-caret-right"></i>
                </button>
              </li>
              <li style="margin: 10px; text-align: center; line-height: 31px;">
                <div class="numberPagination">
                  <!-- {{ current_page }} -->
                  <input
                    style="background: #fff;
                 border: 1px solid rgba(112, 112, 112, 0.38);
                 width: 42px;
                 height: 31px;
                 text-align: center;"
                    type="text"
                    type="number"
                    min="1"
                    [max]="totalPage"
                    #pageNumber
                    [value]="current_page"
                    (keyup.enter)="changePagination(pageNumber)"
                  />
                </div>
              </li>
              <li>
                <button
                  class="arrow"
                  [disabled]="current_page <= 1"
                  (click)="prevPage(current_page)"
                >
                  <i class="fas fa-caret-left"></i>
                </button>
              </li>
              <li style="margin: 15px 10px; box-shadow: none;">
                <div class="pageNum">
                  من
                  <span>{{ totalPage }}</span>
                  صفحة
                </div>
              </li>
            </ul>
          </div>
          <div
            style="text-align: center; margin-top: 20px;"
            *ngIf="!sales.length"
          >
            <h3>عفوا لا توجد طلبات</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="popup" *ngIf="showDeletePopup" [@parentAnimation]>
    <div id="backDrop" (click)="closePopup()"></div>
    <div id="popupData" [@childAnimation]>
      <div class="headerPopup">
        <p>
          <img
            class="fas fa-times"
            (click)="closePopup()"
            src="../../../../assets/img/icons/x.png"
            alt=""
          />
          حذف الطلب
        </p>
      </div>
      <div class="detailsPopup">
        <P>
          هل انت متأكد من حذف طلب العميل <br />
          {{ deletedOrderClientName }}
        </P>

        <div id="confirmationButtons">
          <button type="button" (click)="deleteTechnical()">نعم متأكد</button>
          <button type="button" (click)="closePopup()">إلغاء الحذف</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="popup" *ngIf="showMapPopup">
  <!-- changeVidOrgins() -->

  <div
    class="overlay"
    id="overLay"
    *ngIf="overLayShow"
    (click)="
      showMapPopup = false;
      updateAdressMode = false;
      addNewAddressModeStatus = false
    "
  >
    <div id="popupData">
      <div class="popupMap">
        <app-map
          [orderClientSales]="true"
          [clientDetailsSalesOrgins]="{
            lng: clientMapDetails.long,
            lat: clientMapDetails.lat
          }"
          [clientDetailsSalesPopupOpen]="showMapPopup"
        >
        </app-map>
      </div>
      <!-- </form> -->
    </div>
  </div>
</div>
